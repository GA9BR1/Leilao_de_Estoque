<h1>Lote <%= @batch.code %></h1>
<% if @batch.approved_by %>
  <p>Status: Aprovado</p>
<% else %>
  <p>Status: Aguardando aprovação</p>
<% end %>

<h3>Itens no lote</h3>
<% if @batch_items.present? %>
  <ul id="batch_items">
    <%= render @batch.batch_items %>
  </ul>
<% else %>
  <p>Nâo existem itens no lote</p>
<% end %>
<ul>
  <li><%= Batch.human_attribute_name(:start_date) %>: <%= @batch.start_date %></li>
  <li><%= Batch.human_attribute_name(:end_date) %>: <%= @batch.end_date %></li>
  <li><%= Batch.human_attribute_name(:minimum_bid) %>: <%= @batch.minimum_bid %></li>
  <li><%= Batch.human_attribute_name(:minimum_bid_difference) %>: <%= @batch.minimum_bid_difference %></li>
</ul>


<% if @batch.approved_by %>
  <% if @batch.start_date >= Date.today %>
    <% if @batch.end_date > Date.today %>
      <h3>Lances </h3>
      <% if @batch.bids.present? %>
        <ul>
          <% @batch.bids.each do |bid| %>
            <div>
              <h4>Lance #<%= @batch.bids.index(bid) + 1 %></h3>
              <dl>
                <dt>Valor: </dt>
                <dd><%= bid.amount %></dd>
                <dt>Autor: </dt>
                <dd><%= bid.user.name %></dd>
                <dt>Dia e horário: </dt>
                <dd><%= bid.updated_at %></dd>
              </dl>
            </div>
          <% end %>
        </ul>
      <% else %>
        <p>Ainda não há lances realizados</p>
      <% end %>
      <h3>Realizar um lance</h3>
      <%= link_to 'Realizar um lance', new_bid_path(batch_id: @batch.id) %>
    <% else %>
      <p>O leilão já terminou</p>
    <% end %>
  <% else %>
    <p>O leilão ainda não iniciou</p>
  <% end %>
<% end %>

<button onclick="window.history.back()">Voltar</button>
<% if @batch.approved_by.nil? %>
  <%= render 'batch_items/new' %>
  <%= render 'batch_items/destroy' %>
  <%= button_to 'Aprovar Lote', approve_batch_path(@batch.id), method: :patch %>
<% end %>