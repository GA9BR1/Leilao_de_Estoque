
<%= turbo_stream_from 'batch' %>

<h1>Lote <%= @batch.code %></h1>
<% if @batch.approved_by %>
  <p>Status: Aprovado</p>
<% else %>
  <p>Status: Aguardando aprovação</p>
<% end %>

<h3>Itens no lote</h3>
<% if @batch_items.present? %>
  <ul id="batch_items">
    <%= render @batch.batch_items %>
  </ul>
<% else %>
  <p>Nâo existem itens no lote</p>
<% end %>
<ul>
  <li><%= Batch.human_attribute_name(:start_date) %>: <%= @batch.start_date %></li>
  <li><%= Batch.human_attribute_name(:end_date) %>: <%= @batch.end_date %></li>
  <li><%= Batch.human_attribute_name(:minimum_bid) %>: <%= @batch.minimum_bid %></li>
  <li><%= Batch.human_attribute_name(:minimum_bid_difference) %>: <%= @batch.minimum_bid_difference %></li>
</ul>


<% if @batch.approved_by %>
  <% if @batch.start_date <= Date.today %>
    <% if @batch.end_date > Date.today %> 
      <h3>Lances </h3>
      <ul id="bids">
        <%= render @batch.bids %>
        <% if @batch.bids.empty? %>
          <p id='no_bids'>Ainda não existem lances nesse lote</p>
        <% end %>
      </ul>
      <h3>Realizar um lance</h3>
      <% if user_signed_in? %>
        <%= turbo_frame_tag "new_bid", src: new_batch_bid_path(@batch), target: "_top"%>
      <% else %>
        <p><%= link_to 'Faça login', new_user_session_path(redirect_to: request.original_url)%> para realizar um lance</p>
      <% end %>
    <% else %>
      <p>O leilão já terminou</p>
    <% end %>
  <% else %>
    <p>O leilão ainda não iniciou</p>
  <% end %>
<% end %>

<button onclick="window.history.back()">Voltar</button>
<% if @batch.approved_by.nil? %>
  <%= render 'batch_items/new' %>
  <%= render 'batch_items/destroy' %>
  <%= button_to 'Aprovar Lote', approve_batch_path(@batch.id), method: :patch %>
<% end %>

